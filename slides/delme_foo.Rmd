---
title: "R for Computational Sciences"
subtitle: "Part 2.  Viz, pivot, join, models"
author: "John Little"
institute: "Center for Data & Vizualization Sciences"
params: 
  workshop_date: "Sept. 22"
  workshop_time: "1-3pm"
  registered: 62
  goog_sheet_pre_workshop: "https://docs.google.com/spreadsheets/d/1s1AMfjeU76N56zwY521pVMUX0VoxL6WHZBT2c_3L4bM/edit?resourcekey#gid=275920804"
  goog_post:  ""
  countdown_minutes: 15
output:
  xaringan::moon_reader:
    css: 
      - mystyles/xaringan-themer.css          #  fonts I do want https://pkg.garrickadenbuie.com/xaringanthemer/articles/xaringanthemer.html
      - mystyles/adirondack/story.css         # https://story.xaprb.com/slides/adirondack/
      - mystyles/adirondack/apron.css         # layout 
      #- mystyles/adirondack/adirondack.css   # fonts I don't want
      - mystyles/adirondack/descartes.css     # image positon 
      - mystyles/adirondack/tachyons.min.css  # color, font weights, boxes
      # - mystyles/adirondack/monoblock.css   # part of story/adirondack
      - mystyles/my-theme.css    
    lib_dir: libs
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
---
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(tidyverse)
library(gt)
library(lubridate)
library(hrbrthemes)
library(xaringanthemer)
library(xaringanExtra)
xaringanExtra::use_tachyons()
library(countdown)
library(googlesheets4)
library(htmltools)
tagList(rmarkdown::html_dependency_font_awesome())
```
```{r themes, warning=FALSE, include=FALSE}
style_duo_accent(primary_color = "#012169", secondary_color = "#005587")
# form_data <- read_csv("data/_20200901 Pre-Workshop Survey.csv", 
#     col_types = cols(Timestamp = col_datetime(format = "%m/%d/%Y %H:%M")), 
#     skip = 1)

# *** RUN gs4_auth() in the console ***
# gs4_auth_configure()
pre_workshop <- read_sheet(params$goog_sheet_pre_workshop)
post_workshop <-
  read_sheet("https://docs.google.com/spreadsheets/d/18-xeU5YAOr0iu7Pk22Zrb0BziLuoVe8nyCyd1-O2R7U/edit#gid=123486400")

# mynames_pre <- read_csv("data/colnames_preworkshop_20200918.csv")
# # mynames_post <- read_csv("data/colnames_postworkshop.csv")
mynames_pre  <- read_csv("data/colnames_part1_preworkshop_2021fall.csv")
mynames_post <- read_csv("data/colnames_part1_postworkshop_2021fall.csv")

colnames(pre_workshop) <- mynames_pre$value
colnames(post_workshop) <- mynames_post$value

pre_workshop <- pre_workshop %>%
  mutate(survey_type = "pre")
post_workshop <- post_workshop %>%
  mutate(survey_type = "post") 
```

layout: true


.footercc[
<i class="fab fa-creative-commons"></i>&nbsp; <i class="fab fa-creative-commons-by"></i> <a href = "https://JohnLittle.info"><span class = "opacity30">https://</span>JohnLittle<span class = "opacity30">.info</span></a> 
<span class = "opacity30"> | <a href="https://github.com/libjohn/rfun_flipped">https://github.com/libjohn/rfun_flipped</a> | `r Sys.Date()` </span>
]

---

class: middle
.tc.bg-moon-gray.b--navy.f.ba.bw1.br4.shadow-5.ph4.mt1[

### R for computational sciences

.f3.near-white[  
quickStart: Viz, pivot, join, models
]  

.b[Flipped Workshop]  
.f6[
`r params$workshop_date`, `r params$workshop_time`

]
]

Please **complete** the pre-workshop **survey**  (check your email)

```{r echo=FALSE}
countdown::countdown(minutes = params$countdown_minutes, seconds = 00)
```

---
## Duke University: Land Acknowledgement

I would like to take a moment to honor the land in Durham, NC.  Duke University sits on the ancestral lands of the Shakori, Eno and Catawba people. This institution of higher education is built on land stolen from those peoples.  These tribes were here before the colonizers arrived.  Additionally this land has borne witness to over 400 years of the enslavement, torture, and systematic mistreatment of African people and their descendants.  Recognizing this history is an honest attempt to breakout beyond persistent patterns of colonization and to rewrite the erasure of Indigenous and Black peoples.  There is value in acknowledging the history of our occupied spaces and places.  I hope we can glimpse an understanding of these histories by recognizing the origins of collective journeys.

---
background-image: url(images/who_we_are_2022-09-22_10600.svg)
background-size: contain
<!-- generated from analysis_workshop_attendance/libcal_roster.Rmd -->
<!-- https://github.com/libjohn/workshop_attendance/blob/master/libcal_roster.Rmd -->

---
exclude: false
background-image: url(images/who_we_are_facetwrap_2022-09-22_10600.svg)
background-size: contain
<!-- generated from analysis_workshop_attendance/libcal_roster.Rmd -->
<!-- https://github.com/libjohn/workshop_attendance/blob/master/libcal_roster.Rmd -->

---
```{r response rate plot, echo=FALSE, fig.height=9, fig.width=16, message=FALSE, warning=FALSE, dev="svg"}
response_total <- nrow(pre_workshop)
response_rate <- scales::percent(nrow(pre_workshop) / params$registered)
response_subtitle <- glue::glue('n = {response_total} ; {response_rate} response rate')

my_labels_df <- pre_workshop %>% 
  mutate(day = lubridate::yday(timestamp)) %>% 
  mutate(day_label = lubridate::wday(timestamp, label = TRUE)) |>
  select(day_label, day) |> 
  distinct()


pre_workshop %>% 
  mutate(day = lubridate::yday(timestamp)) %>%
  count(day) %>% 
  ggplot(aes(day, n)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(minor_breaks = NULL, limits = c(0,4)) +
  # scale_y_continuous(breaks = scales::pretty_breaks()) +
  # scale_x_continuous(minor_breaks = NULL, 
  #                    breaks = params$days_of_year_number_range,
  #                    labels = params$days_label) +
  scale_x_continuous(minor_breaks = NULL, 
                     breaks = my_labels_df$day,
                     labels = my_labels_df$day_label) +
  labs(title = "Response rate over time",
       subtitle = response_subtitle, y = "",
       caption = "Source:  CDVS Pre-workshop survey")


```

---
```{r experience plot, echo=FALSE, fig.height=9, fig.width=16, message=FALSE, warning=FALSE, dev="svg"}
pre_workshop %>% 
  pivot_longer(starts_with("tools_"), names_to = "question", values_to = "answer") %>% 
  mutate(question = str_extract(question, ("(?<=tools_)\\w+"))) %>% 
  mutate(question = factor(question, levels = c("coder", "viz", 
                                                "version_ctrl", "cli", "rdbms"))) %>% 
  mutate(answer = factor(answer, levels = c("Daily", "Weekly", "Monthly",
                                            "Several Times per year",
                                            "Less than once per year",
                                            "Never"))) %>% 
  ggplot(aes(fct_rev(question))) +
  geom_bar(aes(fill = answer), position = "fill") +
  coord_flip() +
  scale_fill_brewer(palette = "Dark2") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Self-reported tool usage",
       subtitle = "Respondent's use of a tool / technology / technique",
       x = "", y = "Percent", fill = "",
       caption = "Source:  CDVS Pre-workshop survey") +
  theme_ipsum(grid = "X") +
  theme(plot.title.position = "plot") 
```

---

```{r, skills level plot, echo=FALSE, fig.height=9, fig.width=16, message=FALSE, warning=FALSE, dev="svg"}
pre_workshop %>% 
  pivot_longer(ends_with("_experience"), names_to = "question", values_to = "answer") %>% 
  mutate(answer = factor(answer, 
                         levels = c("Strongly agree", "Agree", 
                                    "Neutral", "Disagree", 
                                    "Strongly disagree"))) %>%
  mutate(question = str_extract(question, "\\w+(?=_experience)")) %>% 
  mutate(question  = factor(question,
                            levels = c("import", "scripts",
                                       "baser_viz", "ggplot2",
                                       "interactive", "pivot",
                                       "join"),
                            labels =  c("Import", "Scritps", "Base-R Viz", 
                                        "ggplot2", "Interactive", "Pivot", "Join")
                            )) %>%
  ggplot(aes(fct_rev(question))) +
  geom_bar(aes(fill = answer), position = "fill") +
  coord_flip() +
  scale_fill_brewer(palette = "Spectral") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Self-reported R skills",
       subtitle = "Respondents feel capable of completing a Tidyverse task",
       x = "", y = "Percent",
       caption = "Source:  CDVS Pre-workshop survey",
       fill = "") +
  theme_ipsum(grid = "X") +
  theme(plot.title.position = "plot")
```



