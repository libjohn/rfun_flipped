---
title: "ggplot2 - quick and easy"
author: "John Little"
date: "`r Sys.Date()`"
abstract: "A very quick overview of visualizing data with ggplot2.<p/>"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
---

This code can be found at https://github.com/libjohn/workshop_rfun_flipped/ggplot2_quick.Rmd

## Load library packages

I only need `ggplot2` but I like to load `tidyverse` because it includes 8 complimentary packages, including `ggplot2`.

Get more information from:

- https://tidyverse.org
- https://ggplot2.tidyverse.org

```{r message=FALSE, warning=FALSE}
# library(ggplot2)
library(tidyverse)
```


The ggplot2 template is used to identify the dataframe, identify the x and y axis, and define visualized layers


```
ggplot(data = ---, mapping = aes(x = ---, y = ---)) +
  geom_----()
```

Note:  `----` is meant to imply text (function names, dataframe names, variablenames) you supply.

It is helpful to see the argument mapping, above.  In practice, rather than typing the formal arguments, code is typically shorthanded to this:

```
dataframe %>% 
  ggplot(aes(xvar, yvar)) +
  geom_----() 
```



## Goal

Visualize a scatter plot showing the relationship of mass to height for _Star Wars_ characters in the `dplyr::starwars` dataframe, excluding the heaviest character.  Indicate a linear regression line.

```{r echo=FALSE, message=FALSE, warning=FALSE}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot(aes(height, mass)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE)
```


## Import data

dplyr has an onboard dataset, `starwars`

```{r}
data(starwars)
starwars
```

## Steps to Visualization

### Draw the base layer

This feels like, and looks like, you drew an empty box.  

```{r}
starwars %>% 
  ggplot() 
```

_But wait, there's more...._

### Map the aesthetics to variables in the dataframe

Still doesn't look like much.  You will initialize the plot scales and labels based on the values of the variables in the dataframe.

```{r}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot(aes(height, mass))
```


In the above, I subset the data, removing any _Star Wars_ characters weighing more than 500 Kg -- `dplyr::filter()`.  Then I initialized the base layer with the `height` as the x axis and `mass` as the y axis.  ggplot drew the scales for me.


### Visualize a layer

Since I have two numeric variables, `height` and `mass`, I'll start with a scatter plot.  Scatter plots are generated by the `geom_point()` function.  


```{r message=FALSE, warning=FALSE}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot(aes(height, mass)) +
  geom_point() 
```



### Global v local arguments

- Mapping aesthetics in the ggplot argument maps aesthetics as global arguments (above)
- Arguments can also be set locally in the local layer function

#### `aes()` arguments mapped _locally_ in `geom_point()`

```{r message=FALSE, warning=FALSE}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot() +
  geom_point(aes(height, mass)) 
```

### Mapping v Setting

Many arguments can be _mapped_ inside the aesthetic, `aes()`,  to leverage variable values, **OR** _set_ a visualized property outside the `aes()` function, but inside the geom_ function.  

Aesthetic arguments include:

- color
- fill
- size
- linetype
- opacity
- shape
- _and more_ see documentation for each geom_

#### Mapping: `color` is **mapped** _inside_ `aes()` function

```{r message=FALSE, warning=FALSE}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot() +
  # geom_point(mapping = aes(x = height, y = mass, color = gender))
  geom_point(aes(height, mass, color = gender))
```

Notice the legend was drawn automatically, above, by mapping an aesthetic


#### Setting: `color` **set** _outside_ the `aes()` function

```{r message=FALSE, warning=FALSE}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot() +
  geom_point(aes(height, mass), color = "goldenrod")
```

## Common geom_ functions

Type         | Geom
-------------|--------------------------
Bar graph:	 |  `geom_bar()` `geom_col()`
Histogram:	 | `geom_hist()`
Scatter plot:|	`geom_point()` `geom_jitter()`
Line graph:  | `geom_line()`
Box plot:	   | `geom_boxplot()`
Density:	   | `geom_density()` `geom_violin()`
Heat map:   	   | `geom_heatmap()`
Mapping:    	   | `geom_sf()`
Regression line: | `geom_smooth()`


> A list of available geom_ functions, or layers, can be found in the help or on the website:      https://ggplot2.tidyverse.org/reference/index.html#section-geoms


### Boxplot

```{r message=FALSE, warning=FALSE}
starwars %>% 
  mutate(species = fct_lump_min(species, 2)) %>% 
  ggplot(aes(species, height)) +
  geom_boxplot() 
```

### Line graph

```{r message=FALSE, warning=FALSE}
babynames::babynames %>% 
  filter(name == "Watts") %>% 
  ggplot(aes(year, n)) +
  # geom_point() +
  geom_line()
```

### Multiple layers

Each layer can support local arguments and draw from the global settings.  Below we use the `geom_line()` function, followed by the `geom_point()` function.

```
babynames %>%
  ggplot(aes(year, prop)) +
  geom_line(aes(color = sex)) +
  geom_point(alpha = 0.4, shape = "cross")
```

![](images/line_graph_je_names.png)

But there is more to that graph, here's the full code for the above graph.

```
library(babynames)
library(ggplot)

babynames %>% 
  filter(name == "John" & sex == "M" | 
           name == "Elizabeth" & sex == "F") %>% 
  ggplot(aes(year, prop)) +
  geom_line(aes(color = sex)) +
  geom_point(alpha = 0.4, shape = "cross") +
  geom_text(data = . %>% filter(year == 1965), aes(label = name),
            nudge_y = .009) +
  labs(title = "Name Popularity") + 
  theme(legend.position = "none")
````

### Goal

Recall the goal mentioned in the beginning.  We want a scatter plot and a regression line.  This can be accomplished by adding a layer in the form of another geom_ function:  `geom_smooth()` 

```{r message=FALSE, warning=FALSE}
starwars %>% 
  filter(mass < 500) %>% 
  ggplot(aes(height, mass)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE)
```

## Arrange order 

Categorical values are most easily ordered with the `forcats` library. Part of the tidyverse, forcats will convert string data into factors, i.e. categorical data.  This enables ordering.


```{r}
msleep %>% 
  ggplot(aes(vore)) +
  geom_bar()
```
### forcats::fct_infreq()

Change the order of the bars by the frequency of observations.

```{r}
msleep %>% 
  ggplot(aes(fct_infreq(vore))) +
  geom_bar() 
```

Notice below, we use the `fill =` argument to set the color of the bar.  In the scatter plot, above, we used the `color =` argument.  For many geoms you can use both `color` and `fill`.  How do these arguments differ?  Where can you look to find out more about `fill` and `color`?

```{r}
starwars %>% 
  ggplot(aes(fct_rev(fct_infreq(eye_color)))) +
  geom_bar(fill = "grey70") +
  geom_bar(data = starwars %>% filter(eye_color == "orange"), fill = "darkorange") +
  coord_flip()
  
```

## Facet wrap

Faceting is great way to make subplots of the same dataframe.  See both `facet_wrap()` and `facet_grid()`

```{r}
mpg %>% 
  ggplot(aes(displ, hwy)) +
  geom_point() +
  facet_wrap(~ class)
```

## Scales

I'll briefly introduce the use of scales to affect.  In this case, scales are used to affect the color of the  plot.  [Read more about  scales](https://ggplot2.tidyverse.org/reference/index.html#section-scales).

Viridis scales apply color palettes to continuous, discrete, or binned data


```{r}
msleep %>% 
  ggplot(aes(fct_infreq(vore), sleep_total)) +
  geom_col(aes(fill = conservation)) +
  scale_fill_viridis_d(na.value = "grey80")
```

The color brewer palette is similar but has a wider array of palettes to choose from.  


```{r}
msleep %>% 
  ggplot(aes(fct_infreq(vore), sleep_total)) +
  geom_col(aes(fill = conservation)) +
  scale_fill_brewer(type = "qual", na.value = "grey80") 
```

To find available colors:  Google search "R color names", or specific to ColorBrewer....

```{r fig.height=8}
#display.brewer.pal(7,"Dark2")
RColorBrewer::display.brewer.all()
```

Sometimes a manual scale is preferred.  I like to google-search: "R color names" for helpful documentation.

```{r}
mycolors <- c("firebrick", "forestgreen", "navy", "darkorange", 
               "goldenrod", "sienna")

msleep %>% 
  ggplot(aes(fct_infreq(vore), sleep_total)) +
  geom_col(aes(fill = conservation)) +
  scale_fill_manual(values = mycolors, na.value = "grey80") 
```

Scales are used to manipulate the visual properties of the data.  Beyond using scales to modify colors, another example is logarithmic scales to account for data skew.  In this way you can clarify the data pattern. For example, using the `ChickWeight` dataset, we visualize the weights of the chicks over time. 

```{r}
data("ChickWeight")

ChickWeight %>% 
  ggplot(aes(Time, weight, color = Diet)) +
  geom_line(aes(group = Chick))
```

Using `scale_y_log10` we can alter the scale to highlight a more understandable data pattern

```{r}
ChickWeight %>% 
  ggplot(aes(Time, weight, color = Diet)) +
  geom_line(aes(group = Chick)) +
  scale_y_log10()

```



## Labels

The `labs()` function is specialized scales function, used to apply labels.  See more on [scales](https://ggplot2.tidyverse.org/reference/index.html#section-scales).

```{r}
plot_sleep <- msleep %>% 
  mutate(vore = case_when(
    vore == "herbi" ~ "Herbivore",
    vore == "omni"  ~ "Omnivore",
    vore == "carni" ~ "Carnivore",
    vore == "insecti" ~ "Insectivore"
  ))  %>%
  ggplot(aes(fct_infreq(vore), sleep_total)) +
  geom_col(aes(fill = conservation)) +
  scale_fill_brewer(type = "qual", na.value = "grey80") +
  labs(title = "Animal sleep times", 
       subtitle = "A practice dataset",
       fill = "Conservation\nType",
       x = "",
       y = "Sleep time in hours",
       caption = "Source: ggplot::msleep")

plot_sleep
```

## Themes

- https://ggplot2.tidyverse.org/reference/ggtheme.html

    - for example... `theme_dark()`, `theme_light()`, `theme_classic()`

- https://cinc.rud.is/web/packages/hrbrthemes/
- https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/

```{r}
plot_sleep +
  theme_dark()
```

```{r}
plot_sleep +
  theme_classic()
```

### hbrthemes

https://cinc.rud.is/web/packages/hrbrthemes/

```{r message=FALSE, warning=FALSE}
plot_sleep +
  hrbrthemes::theme_ipsum(grid = "Y") +
  hrbrthemes::scale_fill_ipsum(na.value = "grey80",
                               labels = c("Critical", "Domesticated", 
                                          "Endangered", "Least Concern", 
                                          "Threatened", "Vulnerable")) +
  theme(plot.title.position = "plot")
```

## Reinforce your learning 

On your own...

Interactive Exercises from [RStudio Primers -- Visualization](https://rstudio.cloud/learn/primers/3)

[Angela Zoss code exercises](https://github.com/amzoss/ggplot2-DF19) 


## Resources

[Designing effective visualizations](https://introds.org/slides/w4_d1-effective-dataviz/w4_d1-effective-dataviz.html#26) by Dr. Mine Çetinkaya-Rundel - _Introduction to Data Science_ https://introds.org

[Data Visualization: A Practical Introduction](https://socviz.co/lookatdata.html) Kieran Healy

### Also, the ggplot2 book

[ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/) Hadley Wickham

[Data Visualization with R](https://rkabacoff.github.io/datavis/) Rob Kabacoff
